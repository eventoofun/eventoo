<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Integraci√≥n - Dashboard de Monetizaci√≥n</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }
        
        .test-result {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }
        
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        .info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test de Integraci√≥n - Dashboard de Monetizaci√≥n</h1>
        <p>Pruebas para verificar la integraci√≥n del Plan Executor con el Dashboard</p>
        
        <div class="test-section">
            <h2>1. Carga de Scripts</h2>
            <div id="scriptTests"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Plan Executor</h2>
            <div id="executorTests"></div>
            <button onclick="testPlanExecutor()">Probar Plan Executor</button>
        </div>
        
        <div class="test-section">
            <h2>3. Monetization Planner</h2>
            <div id="plannerTests"></div>
            <button onclick="testMonetizationPlanner()">Probar Monetization Planner</button>
        </div>
        
        <div class="test-section">
            <h2>4. Integraci√≥n del Dashboard</h2>
            <div id="dashboardTests"></div>
            <button onclick="testDashboardIntegration()">Probar Integraci√≥n</button>
        </div>
        
        <div class="test-section">
            <h2>5. Funcionalidades del Plan Executor</h2>
            <div id="executorFeatures"></div>
            <button onclick="testExecutorFeatures()">Probar Funcionalidades</button>
        </div>
        
        <div class="test-section">
            <h2>6. Navegaci√≥n del Dashboard</h2>
            <div id="navigationTests"></div>
            <button onclick="testNavigation()">Probar Navegaci√≥n</button>
        </div>
        
        <div class="test-section">
            <h2>7. Resumen de Pruebas</h2>
            <div id="summaryTests"></div>
            <button onclick="runAllTests()">Ejecutar Todas las Pruebas</button>
        </div>
    </div>

    <script>
        // Test results tracking
        let testResults = {
            scripts: { passed: 0, failed: 0, total: 0 },
            executor: { passed: 0, failed: 0, total: 0 },
            planner: { passed: 0, failed: 0, total: 0 },
            dashboard: { passed: 0, failed: 0, total: 0 },
            features: { passed: 0, failed: 0, total: 0 },
            navigation: { passed: 0, failed: 0, total: 0 }
        };

        function addTestResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function testScriptLoading() {
            const tests = [
                { name: 'Monetization Planner', global: 'MonetizationPlanner' },
                { name: 'Plan Executor', global: 'PlanExecutor' },
                { name: 'Dashboard', global: 'MonetizationDashboard' }
            ];

            tests.forEach(test => {
                testResults.scripts.total++;
                if (window[test.global]) {
                    addTestResult('scriptTests', `‚úÖ ${test.name} cargado correctamente`, 'success');
                    testResults.scripts.passed++;
                } else {
                    addTestResult('scriptTests', `‚ùå ${test.name} no est√° disponible`, 'error');
                    testResults.scripts.failed++;
                }
            });
        }

        async function testPlanExecutor() {
            const container = 'executorTests';
            document.getElementById(container).innerHTML = '';
            
            try {
                testResults.executor.total++;
                const executor = new PlanExecutor();
                addTestResult(container, '‚úÖ PlanExecutor instanciado correctamente', 'success');
                testResults.executor.passed++;
                
                testResults.executor.total++;
                if (typeof executor.activatePlan === 'function') {
                    addTestResult(container, '‚úÖ M√©todo activatePlan disponible', 'success');
                    testResults.executor.passed++;
                } else {
                    addTestResult(container, '‚ùå M√©todo activatePlan no encontrado', 'error');
                    testResults.executor.failed++;
                }
                
                testResults.executor.total++;
                if (typeof executor.initializeChallenges === 'function') {
                    addTestResult(container, '‚úÖ M√©todo initializeChallenges disponible', 'success');
                    testResults.executor.passed++;
                } else {
                    addTestResult(container, '‚ùå M√©todo initializeChallenges no encontrado', 'error');
                    testResults.executor.failed++;
                }
                
                // Test mock plan activation
                const mockPlan = {
                    id: 'test_plan_001',
                    travelName: 'Viaje Test Barcelona',
                    totalBudget: 5000,
                    currentAmount: 1500,
                    timeFrame: 8,
                    challenges: [
                        {
                            title: "Cena Ben√©fica Test",
                            description: "Evento de prueba",
                            baseRevenue: 200,
                            difficulty: "F√°cil",
                            timeRequired: 3
                        }
                    ]
                };
                
                testResults.executor.total++;
                const result = await executor.activatePlan(mockPlan);
                if (result.success) {
                    addTestResult(container, '‚úÖ Plan activado exitosamente', 'success');
                    testResults.executor.passed++;
                } else {
                    addTestResult(container, `‚ùå Error al activar plan: ${result.error}`, 'error');
                    testResults.executor.failed++;
                }
                
            } catch (error) {
                addTestResult(container, `‚ùå Error en PlanExecutor: ${error.message}`, 'error');
                testResults.executor.failed++;
            }
        }

        function testMonetizationPlanner() {
            const container = 'plannerTests';
            document.getElementById(container).innerHTML = '';
            
            try {
                testResults.planner.total++;
                const planner = new MonetizationPlanner();
                addTestResult(container, '‚úÖ MonetizationPlanner instanciado correctamente', 'success');
                testResults.planner.passed++;
                
                testResults.planner.total++;
                if (planner.challengeTemplates && planner.challengeTemplates.low) {
                    addTestResult(container, `‚úÖ Plantillas de retos cargadas: ${planner.challengeTemplates.low.length} retos f√°ciles`, 'success');
                    testResults.planner.passed++;
                } else {
                    addTestResult(container, '‚ùå Plantillas de retos no encontradas', 'error');
                    testResults.planner.failed++;
                }
                
                testResults.planner.total++;
                if (planner.challengeTemplates && planner.challengeTemplates.medium) {
                    addTestResult(container, `‚úÖ Retos medios disponibles: ${planner.challengeTemplates.medium.length} retos`, 'success');
                    testResults.planner.passed++;
                } else {
                    addTestResult(container, '‚ùå Retos medios no encontrados', 'error');
                    testResults.planner.failed++;
                }
                
            } catch (error) {
                addTestResult(container, `‚ùå Error en MonetizationPlanner: ${error.message}`, 'error');
                testResults.planner.failed++;
            }
        }

        function testDashboardIntegration() {
            const container = 'dashboardTests';
            document.getElementById(container).innerHTML = '';
            
            try {
                testResults.dashboard.total++;
                const dashboard = new MonetizationDashboard();
                addTestResult(container, '‚úÖ MonetizationDashboard instanciado correctamente', 'success');
                testResults.dashboard.passed++;
                
                testResults.dashboard.total++;
                if (dashboard.planExecutor && dashboard.monetizationPlanner) {
                    addTestResult(container, '‚úÖ PlanExecutor y MonetizationPlanner integrados', 'success');
                    testResults.dashboard.passed++;
                } else {
                    addTestResult(container, '‚ùå Integraci√≥n incompleta', 'error');
                    testResults.dashboard.failed++;
                }
                
                testResults.dashboard.total++;
                if (typeof dashboard.activatePlan === 'function') {
                    addTestResult(container, '‚úÖ M√©todo activatePlan integrado', 'success');
                    testResults.dashboard.passed++;
                } else {
                    addTestResult(container, '‚ùå M√©todo activatePlan no integrado', 'error');
                    testResults.dashboard.failed++
                }
                
                testResults.dashboard.total++;
                if (dashboard.plans && dashboard.plans.size > 0) {
                    addTestResult(container, `‚úÖ Datos mock cargados: ${dashboard.plans.size} planes`, 'success');
                    testResults.dashboard.passed++;
                } else {
                    addTestResult(container, '‚ùå Datos mock no cargados', 'error');
                    testResults.dashboard.failed++;
                }
                
                // Store dashboard instance for other tests
                window.testDashboard = dashboard;
                
            } catch (error) {
                addTestResult(container, `‚ùå Error en Dashboard: ${error.message}`, 'error');
                testResults.dashboard.failed++;
            }
        }

        async function testExecutorFeatures() {
            const container = 'executorFeatures';
            document.getElementById(container).innerHTML = '';
            
            try {
                const executor = new PlanExecutor();
                
                testResults.features.total++;
                if (typeof executor.validatePlan === 'function') {
                    addTestResult(container, '‚úÖ M√©todo validatePlan disponible', 'success');
                    testResults.features.passed++;
                } else {
                    addTestResult(container, '‚ùå M√©todo validatePlan no encontrado', 'error');
                    testResults.features.failed++;
                }
                
                testResults.features.total++;
                if (typeof executor.prepareExecutionPlan === 'function') {
                    addTestResult(container, '‚úÖ M√©todo prepareExecutionPlan disponible', 'success');
                    testResults.features.passed++;
                } else {
                    addTestResult(container, '‚ùå M√©todo prepareExecutionPlan no encontrado', 'error');
                    testResults.features.failed++;
                }
                
                testResults.features.total++;
                if (typeof executor.calculateChallengeDate === 'function') {
                    addTestResult(container, '‚úÖ M√©todo calculateChallengeDate disponible', 'success');
                    testResults.features.passed++;
                } else {
                    addTestResult(container, '‚ùå M√©todo calculateChallengeDate no encontrado', 'error');
                    testResults.features.failed++;
                }
                
                // Test plan validation
                const validPlan = {
                    id: 'test_valid',
                    travelName: 'Test Viaje',
                    totalBudget: 1000,
                    timeFrame: 4,
                    challenges: []
                };
                
                testResults.features.total++;
                if (executor.validatePlan(validPlan)) {
                    addTestResult(container, '‚úÖ Validaci√≥n de plan v√°lido funciona', 'success');
                    testResults.features.passed++;
                } else {
                    addTestResult(container, '‚ùå Validaci√≥n de plan v√°lido falla', 'error');
                    testResults.features.failed++;
                }
                
                const invalidPlan = {
                    id: 'test_invalid',
                    travelName: 'Test Viaje'
                    // Missing required fields
                };
                
                testResults.features.total++;
                if (!executor.validatePlan(invalidPlan)) {
                    addTestResult(container, '‚úÖ Validaci√≥n de plan inv√°lido funciona', 'success');
                    testResults.features.passed++;
                } else {
                    addTestResult(container, '‚ùå Validaci√≥n de plan inv√°lido falla', 'error');
                    testResults.features.failed++;
                }
                
            } catch (error) {
                addTestResult(container, `‚ùå Error en caracter√≠sticas: ${error.message}`, 'error');
                testResults.features.failed++;
            }
        }

        function testNavigation() {
            const container = 'navigationTests';
            document.getElementById(container).innerHTML = '';
            
            try {
                if (window.testDashboard) {
                    const dashboard = window.testDashboard;
                    
                    testResults.navigation.total++;
                    dashboard.loadSection('overview');
                    addTestResult(container, '‚úÖ Navegaci√≥n a Overview funciona', 'success');
                    testResults.navigation.passed++;
                    
                    testResults.navigation.total++;
                    dashboard.loadSection('plans');
                    addTestResult(container, '‚úÖ Navegaci√≥n a Plans funciona', 'success');
                    testResults.navigation.passed++;
                    
                    testResults.navigation.total++;
                    dashboard.loadSection('execution');
                    addTestResult(container, '‚úÖ Navegaci√≥n a Execution funciona', 'success');
                    testResults.navigation.passed++;
                    
                    testResults.navigation.total++;
                    if (dashboard.currentSection === 'execution') {
                        addTestResult(container, '‚úÖ Estado de navegaci√≥n actualizado correctamente', 'success');
                        testResults.navigation.passed++;
                    } else {
                        addTestResult(container, '‚ùå Estado de navegaci√≥n no actualizado', 'error');
                        testResults.navigation.failed++;
                    }
                    
                } else {
                    addTestResult(container, '‚ùå Dashboard no disponible para pruebas de navegaci√≥n', 'error');
                    testResults.navigation.failed += 4;
                    testResults.navigation.total += 4;
                }
            } catch (error) {
                addTestResult(container, `‚ùå Error en navegaci√≥n: ${error.message}`, 'error');
                testResults.navigation.failed++;
            }
        }

        function runAllTests() {
            // Reset results
            testResults = {
                scripts: { passed: 0, failed: 0, total: 0 },
                executor: { passed: 0, failed: 0, total: 0 },
                planner: { passed: 0, failed: 0, total: 0 },
                dashboard: { passed: 0, failed: 0, total: 0 },
                features: { passed: 0, failed: 0, total: 0 },
                navigation: { passed: 0, failed: 0, total: 0 }
            };
            
            // Clear all containers
            ['scriptTests', 'executorTests', 'plannerTests', 'dashboardTests', 'executorFeatures', 'navigationTests', 'summaryTests'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            // Run tests sequentially
            testScriptLoading();
            
            setTimeout(() => {
                testMonetizationPlanner();
                testPlanExecutor();
                testDashboardIntegration();
                testExecutorFeatures();
                testNavigation();
                
                setTimeout(() => {
                    // Generate summary
                    const summary = document.getElementById('summaryTests');
                    const totalPassed = Object.values(testResults).reduce((sum, category) => sum + category.passed, 0);
                    const totalFailed = Object.values(testResults).reduce((sum, category) => sum + category.failed, 0);
                    const totalTests = Object.values(testResults).reduce((sum, category) => sum + category.total, 0);
                    
                    addTestResult('summaryTests', `üìä Resumen de Pruebas:`, 'info');
                    addTestResult('summaryTests', `‚úÖ Aprobadas: ${totalPassed}/${totalTests}`, 'success');
                    addTestResult('summaryTests', `‚ùå Fallidas: ${totalFailed}/${totalTests}`, 'error');
                    addTestResult('summaryTests', `üìà Porcentaje de √©xito: ${Math.round((totalPassed/totalTests) * 100)}%`, 'info');
                    
                    // Detailed breakdown
                    Object.entries(testResults).forEach(([category, results]) => {
                        if (results.total > 0) {
                            const percentage = Math.round((results.passed/results.total) * 100);
                            const status = percentage === 100 ? 'success' : percentage >= 80 ? 'info' : 'error';
                            addTestResult('summaryTests', `${category}: ${results.passed}/${results.total} (${percentage}%)`, status);
                        }
                    });
                }, 1000);
            }, 500);
        }

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            testScriptLoading();
            addTestResult('scriptTests', '‚úÖ P√°gina de test cargada correctamente', 'info');
        });
    </script>
</body>
</html>